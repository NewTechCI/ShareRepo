machine:
 pre:
  - rvm use 2.3.0
 ruby:
  version: ruby-2.3.0
#  version: ruby-2.1.4

 timezone:
    Asia/Tokyo
 services:
  - docker


dependencies:
 cache_directories:
  - "~/cache"
 pre:
  - bash ./bundle-install.sh
  - bash ./create-rspec-file.sh
 override:
  - docker info
  - bash ./docker-build.sh
  #- docker run -d -p 80:8080 newtechci/docker-circleci

  - docker run --name newtech -d -p 8080:80 nnagasi/docker-circleci
test:
  override:
   #- docker run -d -p 80:80 newtechci/docker-circleci

   - DOCKER_IP=`docker inspect --format '{{.NetworkSettings.IPAddress}}' newtech`
   - export DOCKER_IP
   - printenv DOCKER_IP

   #- docker run -d -p 80:80 nnagasi/docker-circleci
   - bash ./exec-serverspec.sh

deployment:
  hub:
    branch: [master,nnagasi_work]
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      #- docker push newtechci/docker-circleci
      - docker push nnagasi/docker-circleci
